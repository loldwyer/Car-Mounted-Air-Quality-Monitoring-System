<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Car-Mounted Air Quality Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

    <!-- Header -->
  <header>
    <h1>T1: Car Portable Urban Air Quality Monitor</h1>
    <p>Live CO₂, PM, NO₂ readings from ESP32 + Blynk + ThingSpeak</p>
  </header>


  <!-- Top Banner Navigation -->
  <nav class="topnav">
    <ul>
      <li><a href="#sensor-overview" class="active">Sensor Overview</a></li>
      <li><a href="#hardware">Hardware</a></li>
      <li><a href="#enclosure">Enclosure & Mounting</a></li>
      <li><a href="#deployment">Deployment</a></li>
    </ul>
  </nav>

  <!-- Sensor Section -->
  <section id="sensor-overview">
    <h2>Sensor Overview</h2>

    <label for="sensorSelect"><strong>View by Sensor:</strong></label>
    <select id="sensorSelect" onchange="handleSensorSelect(this.value)">
      <option value="none">-- Select --</option>
      <option value="scd30">SCD30 (CO₂, Temp, RH)</option>
      <option value="sps30">SPS30 (PM1.0, PM2.5, PM10)</option>
      <option value="mics">MiCS-4514 (NO₂)</option>
    </select>

    <div class="tabs">
      <button class="tablink" onclick="showTab('co2', this)">CO₂</button>
      <button class="tablink" onclick="showTab('pm25', this)">PM2.5</button>
      <button class="tablink" onclick="showTab('pm10', this)">PM10</button>
      <button class="tablink" onclick="showTab('pm1', this)">PM1.0</button>
      <button class="tablink" onclick="showTab('temp', this)">Temp</button>
      <button class="tablink" onclick="showTab('rh', this)">Humidity</button>
      <button class="tablink" onclick="showTab('no2', this)">NO₂</button>
    </div>

    <div id="sensorTabs" class="tab-group">
      <div id="co2" class="tabcontent tab-box">
        <p><strong>Latest CO₂:</strong> <span id="co2val">Loading...</span> ppm</p>
        <iframe src="https://thingspeak.com/channels/2960675/charts/4?dynamic=true&w=1000&h=400"></iframe>
      </div>

      <div id="pm25" class="tabcontent tab-box">
        <p><strong>Latest PM2.5:</strong> <span id="pm25val">Loading...</span> µg/m³</p>
        <iframe src="https://thingspeak.com/channels/2960675/charts/2?dynamic=true&w=1000&h=400"></iframe>
      </div>

      <div id="pm10" class="tabcontent tab-box">
        <p><strong>Latest PM10:</strong> <span id="pm10val">Loading...</span> µg/m³</p>
        <iframe src="https://thingspeak.com/channels/2960675/charts/3?dynamic=true&w=1000&h=400"></iframe>
      </div>

      <div id="pm1" class="tabcontent tab-box">
        <p><strong>Latest PM1.0:</strong> <span id="pm1val">Loading...</span> µg/m³</p>
        <iframe src="https://thingspeak.com/channels/2960675/charts/1?dynamic=true&w=1000&h=400"></iframe>
      </div>

      <div id="temp" class="tabcontent tab-box">
        <p><strong>Latest Temp:</strong> <span id="tempval">Loading...</span> °C</p>
        <iframe src="https://thingspeak.com/channels/2960675/charts/5?dynamic=true&w=1000&h=400"></iframe>
      </div>

      <div id="rh" class="tabcontent tab-box">
        <p><strong>Latest Humidity:</strong> <span id="humval">Loading...</span> %</p>
        <iframe src="https://thingspeak.com/channels/2960675/charts/6?dynamic=true&w=1000&h=400"></iframe>
      </div>

      <div id="no2" class="tabcontent tab-box">
        <p><strong>Latest NO₂ Voltage:</strong> <span id="no2val">Loading...</span> V</p>
        <iframe src="https://thingspeak.com/channels/2960675/charts/7?dynamic=true&w=1000&h=400"></iframe>
      </div>
    </div>
  </section>

  <!-- Hardware Section -->
  <section id="hardware">
    <h2>Hardware Overview</h2>
    <p>This system uses the following components:</p>
    <ul>
      <li><a href="#" target="_blank">ESP32-DEVKITC-VE</a></li>
      <li><a href="#" target="_blank">SCD30: CO₂, Temperature, Humidity</a></li>
      <li><a href="#" target="_blank">SPS30: PM1.0, PM2.5, PM10</a></li>
      <li><a href="#" target="_blank">MiCS-4514: NO₂</a></li>
      <li><a href="#" target="_blank">DS3231 RTC</a></li>
      <li><a href="#" target="_blank">MicroSD Card Module</a></li>
      <li><a href="#" target="_blank">OLED or LCD Display (optional)</a></li>
      <li><a href="#" target="_blank">Li-Ion Battery Pack</a></li>
    </ul>
    <p>Wiring diagrams, schematic PDFs, and BOM available upon request.</p>
  </section>

  <!-- Enclosure Section -->
  <section id="enclosure">
    <h2>Enclosure & Mounting</h2>
    <p>The sensor enclosure was custom designed to allow optimal airflow and protection from debris. It was mounted to a vehicle dashboard using industrial double-sided tape and vent-mounted clips.</p>
    <ul>
      <li>Material: 3D printed PLA</li>
      <li>Design files: <a href="#">Download STL</a></li>
      <li>Mounting method: Dashboard adhesive + cable management</li>
      <li>Photos: <a href="#">View Gallery</a></li>
    </ul>
  </section>

  <!-- Deployment Section -->
  <section id="deployment">
    <h2>Deployment</h2>
    <p>Data was collected across various urban locations during rush hour. The device was powered by a 10,000mAh battery and uploaded readings via Wi-Fi (hotspot or public).</p>
    <ul>
      <li>Location: Dublin City, M50 Corridor</li>
      <li>Dates: July 2025</li>
      <li>Power runtime: ~6 hours continuous</li>
      <li>Data synced every 30 seconds to ThingSpeak and Blynk</li>
    </ul>
    <p>GPS data and maps can be integrated in future work.</p>
  </section>

  <footer>
    <p>&copy; 2025 Lauren Dwyer | MEng ECE | Final Year Thesis Project</p>
  </footer>

  <script>
    const tabGroups = {
      scd30: ['co2', 'temp', 'rh'],
      sps30: ['pm1', 'pm25', 'pm10'],
      mics: ['no2']
    };

    function showTab(id, el) {
      hideAllTabs();
      document.getElementById(id).style.display = 'block';
      document.querySelectorAll('.tablink').forEach(btn => btn.classList.remove('active'));
      if (el) el.classList.add('active');
      document.getElementById('sensorSelect').value = 'none';
    }

    function handleSensorSelect(sensor) {
      hideAllTabs();
      if (sensor in tabGroups) {
        tabGroups[sensor].forEach(id => {
          document.getElementById(id).style.display = 'block';
        });
        document.querySelectorAll('.tablink').forEach(btn => btn.classList.remove('active'));
      }
    }

    function hideAllTabs() {
      document.querySelectorAll('.tabcontent').forEach(el => el.style.display = 'none');
    }

    async function fetchThingSpeakData() {
      try {
        const response = await fetch('https://api.thingspeak.com/channels/2960675/feeds.json?results=1');
        const data = await response.json();
        if (data && data.feeds.length > 0) {
          const feed = data.feeds[0];
          document.getElementById('co2val').textContent = parseFloat(feed.field4).toFixed(1);
          document.getElementById('pm25val').textContent = parseFloat(feed.field2).toFixed(1);
          document.getElementById('pm10val').textContent = parseFloat(feed.field3).toFixed(1);
          document.getElementById('pm1val').textContent = parseFloat(feed.field1).toFixed(1);
          document.getElementById('tempval').textContent = parseFloat(feed.field5).toFixed(1);
          document.getElementById('humval').textContent = parseFloat(feed.field6).toFixed(1);
          document.getElementById('no2val').textContent = parseFloat(feed.field7).toFixed(3);
        }
      } catch (e) {
        console.error("ThingSpeak fetch failed:", e);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      showTab('co2', document.querySelector(".tablink"));
      fetchThingSpeakData();
      setInterval(fetchThingSpeakData, 30000);
    });
  </script>
</body>
</html>
